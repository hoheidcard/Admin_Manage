import{k as F,u as x,s as R,x as E,d as B,e as P,n as V,l as j,r as p,o as n,c as a,a as e,j as f,t as I,b as o,g as r,f as m}from"./index-DwPljJjs.js";import{_ as D}from"./no-image-Cge9pZ0v.js";import{C as L}from"./cropper-DeyK3aZp.js";const q={class:"profile-layout"},N={class:"container"},W={class:"left-card card"},$={class:"top-info"},H=["src"],G={key:1,src:D,alt:""},J={class:"info"},K={class:"name"},Q=e("div",{class:"text"},"Welcome,",-1),T={class:"about f-w-bold"},X={class:"bottom-links bottom-links-desk"},Y=e("div",{class:"title"},"Profile",-1),Z={class:"icon"},tt=e("div",{class:"title"},"Students",-1),et={class:"icon"},ot=e("div",{class:"title"},"Department",-1),st={class:"icon"},it=e("div",{class:"title"},"Subject",-1),nt={class:"icon"},at=e("div",{class:"title"},"Documents",-1),ct={class:"icon"},lt={class:"right-card card"},rt=e("div",{class:"title",showHeader:"true"},"Upload Image",-1),dt={class:"image-upload-crop"},pt={key:0},ft=["src"],_t=e("br",null,null,-1),ut=e("br",null,null,-1),gt={key:1},mt=["src"],ht={class:"modal-footer"},vt={class:"btns"},yt={__name:"StaffProfileLayout",setup(It){const h=F(null),d=x(),u=R();E();const _=B(()=>d.state.OrganizationStaff),t=P({staffAccountId:null,settingId:null,cropModal:!1,imageUrl:null,imageFile:null,croppedImageUrl:null,cropper:null,cropperEnable:!1,type:""});V(()=>{u.query.id&&(t.staffAccountId=u.query.id,t.settingId=u.query.settingId,S(),M())}),j(()=>{t.cropper&&t.cropper.destroy()});const b=()=>{t.cropper&&t.cropper.destroy(),t.cropperEnable=!1},k=()=>{t.cropper&&t.cropper.destroy(),t.cropperEnable=!0;const s=h.value;t.cropper=new L(s,{aspectRatio:35/45,viewMode:1})},C=s=>{t.imageFile=s.target.files[0],t.imageFile&&t.imageFile.type.startsWith("image/")&&(t.imageUrl=URL.createObjectURL(t.imageFile))},y=()=>{const s=t.cropper.getCroppedCanvas();t.croppedImageUrl=s.toDataURL()};async function w(){if(!t.cropperEnable)d.dispatch("OrganizationStaff/updateProfileImage",{id:t.staffAccountId,file:t.imageFile});else{const s=t.cropper.getCroppedCanvas(),i=await new Promise(l=>s.toBlob(l)),c=new File([i],"cropped-image.png",{type:"image/png"});d.dispatch("OrganizationStaff/updateProfileImage",{id:t.staffAccountId,file:c})}t.cropModal=!1}function U(){t.cropModal=!0}function S(){d.dispatch("OrganizationStaff/getOneStaff",{id:t.staffAccountId})}function M(){d.dispatch("OrganizationSettings/getOneOrganizationSettings",{id:t.settingId})}return(s,i)=>{var v;const c=p("icon-right-arrow"),l=p("router-link"),O=p("router-view"),A=p("icon-cross"),z=p("Modal");return n(),a("section",q,[e("div",N,[e("div",W,[e("div",$,[e("div",{class:"img",onClick:f(U,["prevent"])},[_.value.profile?(n(),a("img",{key:0,src:_.value.profile,alt:""},null,8,H)):(n(),a("img",G))]),e("div",J,[e("div",K,[Q,e("h3",null,I(_.value.name),1)]),e("div",T,I((v=_.value.designation)==null?void 0:v.name),1)])]),e("div",X,[o(l,{to:"/crm/school-staff-profile?id="+t.staffAccountId+"&settingId="+t.settingId,class:"profile-link"},{default:r(()=>[Y,e("div",Z,[o(c)])]),_:1},8,["to"]),o(l,{to:"/crm/school-staff-class-students?id="+t.staffAccountId+"&settingId="+t.settingId,class:"profile-link"},{default:r(()=>[tt,e("div",et,[o(c)])]),_:1},8,["to"]),o(l,{to:"/crm/school-staff-department?id="+t.staffAccountId+"&settingId="+t.settingId,class:"profile-link"},{default:r(()=>[ot,e("div",st,[o(c)])]),_:1},8,["to"]),o(l,{to:"/crm/school-staff-subject?id="+t.staffAccountId+"&settingId="+t.settingId,class:"profile-link"},{default:r(()=>[it,e("div",nt,[o(c)])]),_:1},8,["to"]),o(l,{to:"/crm/school-staff-documents?id="+t.staffAccountId+"&settingId="+t.settingId,class:"profile-link"},{default:r(()=>[at,e("div",ct,[o(c)])]),_:1},8,["to"])])]),e("div",lt,[o(O)])]),o(z,{show:t.cropModal,"onUpdate:show":i[2]||(i[2]=g=>t.cropModal=g),class:"status-modal",headerClasses:"header-bg"},{header:r(()=>[rt,e("div",{class:"close-btn",onClick:i[0]||(i[0]=f(g=>t.cropModal=!1,["prevent"]))},[o(A)])]),default:r(()=>[e("div",dt,[e("input",{type:"file",onChange:C},null,32),t.imageUrl?(n(),a("div",pt,[e("img",{ref_key:"imageRef",ref:h,src:t.imageUrl,alt:"Source Image",style:{"max-width":"100%"}},null,8,ft),_t,t.cropperEnable?(n(),a("button",{key:0,type:"button",class:"btn green-btn",onClick:y}," Crop Image ")):m("",!0),ut])):m("",!0),t.croppedImageUrl?(n(),a("div",gt,[e("img",{src:t.croppedImageUrl,alt:"Cropped Image",style:{"max-width":"100%",height:"150px"}},null,8,mt)])):m("",!0)]),e("div",ht,[e("div",vt,[e("div",{class:"btn red-btn",onClick:i[1]||(i[1]=f(g=>t.cropModal=!1,["prevent"]))}," Cancel "),t.cropperEnable?(n(),a("div",{key:1,class:"btn green-btn",onClick:f(b,["prevent"])}," Crop ")):(n(),a("div",{key:0,class:"btn green-btn",onClick:f(k,["prevent"])}," Crop ")),e("div",{class:"btn white-btn",onClick:w},"Upload")])])]),_:1},8,["show"])])}}};export{yt as default};
